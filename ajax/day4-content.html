<div class="row">
    <div class="col-md-12">
        
        <h1>Day 4 || Working With Motors:</h1>

        <div class="col-md-9">
            <p>Life is so much easier when your just fixing things... </p>
             <p> -Anakin Skywalker</p>
        </div>
        
        <div class="col-md-3">
            <img src="img/r2d2_13.jpg" alt=""/>
        </div>
        
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h2>Types of Motor Shields:</h2>
        <p>There are hundreds of different types of motor shields/drivers, here are a couple...</p>

        <div class="col-md-3">
            <img src="img/MotorShield_R3_Front.jpg.jpg" alt=""/>
        </div>
        <div class="col-md-3">
            <img src="img/motor-shield-breakout-board.jpg" alt=""/>
        </div>
        <div class="col-md-3">
            <img src="img/adafruit-motor-shield.jpg" alt=""/>
        </div>
        <div class="col-md-3">
            <img src="img/small-motor-shield.jpg" alt=""/>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h2>Learning how to connect the motor driver:</h2>
        <p>We need to tell the Arduino that the motors are connected and what to do with them through "functions".</p>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="col-md-6">
            <img src="img/MotorDriverL298N_Board_800.jpg" alt=""/>
        </div>
        <div class="col-md-6">
            <p>This is our motor shield. This is a complex piece of technology in a small package. That large black thing in the back is a "heat sink" that will keep the chip from over heating.</p>
            <p>You will probably notice that there are some pins like on your Arduino that things can be plugged into. We will use these to "interface" with the hardware.</p>
            <ul>
                <li><p>For now the most important parts of this piece of technology are the screw terminals labeled..</p>
                    <ul>
                        <li><p>OUT1 || which is where a motor will connect</p></li>
                        <li><p>OUT2 || which is another place where a motor will connect</p></li>
                        <li><p>OUT3 || which is another place to connect a motor</p></li>
                        <li><p>OUT4 || which is the remaining place to connect a motor</p></li>
                    </ul>
                </li>
            </ul>
        </div>
        <ul class="col-md-6 col-md-offset-3">
                <li><p>We will also need to setup some pins that will connect the motor driver to the Arduino</p>
                    <ul>
                        <li>
                            <img src="img/basic-motor-wiring.jpg" alt=""/>
                            <p>Follow the chart above to connect the motor driver to the Arduino</p>
                        </li>
                        <li>
                            <p>The connections on the Arduino should match the pins in this image</p>
                            <img src="img/RoboRedPinNumbersMD-450.jpg" alt=""/>
                        </li>
                        <li>
                            <p>On the Motor Driver they should look like this...</p>
                            <img src="img/Motor-Driver-Wiring-200.jpg" style="width:300px;transform: rotate(90deg);" alt=""/>
                        </li>
                        <li>
                            <p>Now take 2 wires from the "rainbow strip" and remove the black covers from only one side.</p>
                            <p>Plug the other side into the Arduino using the double "teeth" pins.</p>
                            <p>Plug this setup into the pins labeled "VIN" and "GND"</p>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h2>Coding the Motor Driver:</h2>
        <p>We need to write the code that will work with the final product</p>
        <pre>

        <code>
            /*
            - CONNECTIONS:
            Pins 9 (Motor1 PWM) and 10 (Motor2 PWM) are predefined, unchangeable

            // Label--Arduino Pin-- Motor Driver Pin
            Motor1A    pin 8           // INA
            Motor1B    pin 7           // INB
            Motor2C    pin 6           // INC
            Motor2D    pin 5           // IND

            - V2.10 11/10/2014


            /*-----( Import needed libraries )-----*/
            #include <YD_MotorDriver1.h>  // For control of the two DC Motors
            #include <NewPing.h>          // Runs the Ultrasonic Distance Sensor
                #include <SM.h>;              // Implements the State Machine that controls action sequence

                    /*-----( Declare Constants and Pin Numbers )-----*/

                    // NOTE: Pins 9 (Motor1) and 10 (Motor2) are predefined, unchangeable
                    #define  Motor1A  8
                    #define  Motor1B  7
                    #define  Motor2C  6
                    #define  Motor2D  5

                    #define  RampDelay  10

                    #define  StartMoveSpeed    200  // Motor Driver value for start of motion

                    #define  SlowMoveSpeed     280
                    #define  SlowMoveAdjust     5   // Adjust for straight move: - Left + Right??

                    #define  MediumMoveSpeed   300
                    #define  MediumMoveAdjust   5  // Adjust for straight move: - Left + Right

                    #define  FastMoveSpeed     350
                    #define  FastMoveAdjust     5  // Adjust for straight move: - Left + Rig

                    // Ultrasonic Sensor Pins
                    #define TRIGGER_PIN  2   // Arduino pin tied to trigger pin on the ultrasonic sensor.
                    #define ECHO_PIN     3   // Arduino pin tied to echo pin on the ultrasonic sensor.
                    #define MAX_DISTANCE 100 // Maximum distance we want to ping for (in centimeters). Maximum sensor distance is rated at 400-500cm.
                    // Servo
                    #define SERVO_PIN    11  // The "Look Around" servo

                    #define PIN13_LED    13  // The onboard LED: Lights when an object is sensed by the Ultrasonic

                    //----( "TARGET FOUND" DIRECTIONS (index into TargetArray )---------
                    #define TARGET_FOUND_ANY     0   // Values will be "true" or "false"
                    #define TARGET_LEFT          1
                    #define TARGET_LEFT_CENTER   2
                    #define TARGET_CENTER        3
                    #define TARGET_RIGHT_CENTER  4
                    #define TARGET_RIGHT         5

                    #define TARGET_ARRAY_SIZE    6

                    #define TARGET_TOO_CLOSE     25

                    /*-----( Declare objects )-----*/
                    YD_MotorDriver1 RobotDriver(Motor1A,Motor1B,Motor2C,Motor2D); // Set pins
                    NewPing sonar(TRIGGER_PIN, ECHO_PIN, MAX_DISTANCE); // Set pins and maximum distance.
                    SM RoboGo(RoboStartState);//create simple statemachine

                    /*-----( Declare Variables )-----*/
                    unsigned int uS;  // Result of a ping: MicroSeconds
                    unsigned int cm;  // Distance calculated for ping (0 = outside set distance range)
                    unsigned int cm_now; // For test

                    int TargetArray[TARGET_ARRAY_SIZE];  // Holds the directions a Target was found in
                    int DirectionsToLook = 3;  // For LookAround()
                    int ServoDirectionData[3] = { 2500, 1600, 600};



                    void setup()   /******************* SETUP: RUNS ONCE *****************/
                    {
                    Serial.begin(115200);
                    delay(1000);
                    Serial.println("YourDuino Robot Kit Test");
                    //--NOTE: Ultrasonic Sensor and Motor Pins set to OUTPUT by their libraries
                    pinMode(SERVO_PIN,OUTPUT);
                    pinMode(PIN13_LED,OUTPUT);
                    RobotDriver.init();

                    }//--(end setup )---

                    /************** LOOP: RUNS CONSTANTLY **************************/
                    void loop()
                    {
                    EXEC(RoboGo);//run statemachine
                    delay(100);
                    }//--(end main loop )---


                    /*----------------( Declare User-written Functions )---------------*/

                    //------( MOTOR CONTROL FUNCTIONS )----------------
                    void ForwardSlow()
                    {
                    RobotDriver.Motor1Speed(SlowMoveSpeed + SlowMoveAdjust);
                    RobotDriver.Motor2Speed(SlowMoveSpeed - SlowMoveAdjust);
                    }
                    /*---------------------------*/

                    void ForwardMedium()
                    {
                    RobotDriver.Motor1Speed(MediumMoveSpeed + MediumMoveAdjust);
                    RobotDriver.Motor2Speed(MediumMoveSpeed - MediumMoveAdjust);
                    }
                    /*---------------------------*/
                    void ForwardFast()
                    {
                    RobotDriver.Motor1Speed(FastMoveSpeed + FastMoveAdjust);
                    RobotDriver.Motor2Speed(FastMoveSpeed - FastMoveAdjust);
                    }
                    /*---------------------------*/
                    void BackwardSlow(int HowMuch)
                    {
                    RobotDriver.Motor1Speed(- SlowMoveSpeed );
                    RobotDriver.Motor2Speed(- SlowMoveSpeed );
                    delay(HowMuch);
                    Stop();
                    }
                    /*---------------------------*/
                    void BackwardMedium(int HowMuch)
                    {
                    RobotDriver.Motor1Speed(- MediumMoveSpeed);
                    RobotDriver.Motor2Speed(- MediumMoveSpeed);
                    delay(HowMuch);
                    Stop();
                    }
                    /*---------------------------*/
                    void BackwardFast(int HowMuch)
                    {
                    RobotDriver.Motor1Speed(- FastMoveSpeed);
                    RobotDriver.Motor2Speed(- FastMoveSpeed);
                    delay(HowMuch);
                    Stop();
                    }
                    /*---------------------------*/
                    void Stop()
                    {
                    RobotDriver.Motor1Speed(0);
                    RobotDriver.Motor2Speed(0);
                    }
                    /*---------------------------*/
                    void SpinLeft(int HowMuch)
                    {
                    RobotDriver.Motor1Speed(  MediumMoveSpeed);
                    RobotDriver.Motor2Speed(- MediumMoveSpeed);
                    delay(HowMuch);
                    Stop();
                    }
                    /*---------------------------*/
                    void SpinRight(int HowMuch)
                    {
                    RobotDriver.Motor1Speed(- MediumMoveSpeed);
                    RobotDriver.Motor2Speed(  MediumMoveSpeed);
                    delay(HowMuch);
                    Stop();
                    }
                    /*---------------------------*/
                    unsigned int PingBlink()
                    {
                    uS = sonar.ping(); // Send ping, get ping time in microseconds (uS).
                    cm = uS / US_ROUNDTRIP_CM; // Convert ping time to distance in cm
                    Serial.print("  cm = ");
                    Serial.print(cm,DEC);

                    if ((cm < 40) && (cm != 0))
                    {
                    return(cm);
                    }
                    else
                    {
                    return(100);  // No Valid Distance
                    }
                    }// end PingBlink
                    /*---------------------------*/

                    void PointServo(int ServoAngle)
                    {

                    for (int i=0;i<20;i++)  // Send the pulse 10 times
                    {
                    digitalWrite(SERVO_PIN,HIGH);
                    delayMicroseconds(ServoAngle);
                    digitalWrite(SERVO_PIN,LOW);
                    delay(20);
                    }
                    }// PointServo end
                    /*---------------------------*/


                    void LookAround()  // Sets next state if Target Found
                    {
                    for(int Direction = 0; Direction < DirectionsToLook ; Direction ++)
                    {
                    Serial.print("DIRECTION = ");
                    Serial.print(Direction,DEC);
                    PointServo(ServoDirectionData[Direction]); // Get servo pulse width from array
                    delay(200);
                    cm_now = PingBlink();    // Read the Ultrasonic distance

                    Serial.print(" cm_now = ");
                    Serial.println(cm_now,DEC);
                    if (cm_now < TARGET_TOO_CLOSE) digitalWrite(PIN13_LED,HIGH);

                    if (cm_now < 40)
                    {
                    TargetArray[TARGET_FOUND_ANY ] = true;
                    }
                    else TargetArray[TARGET_FOUND_ANY ] = false;

                    if ((cm_now < TARGET_TOO_CLOSE) && (Direction == 2)) //LEFT
                    {
                    TargetArray[TARGET_LEFT ] = true;
                    Serial.println("TargetLeft");
                    }

                    if ((cm_now < TARGET_TOO_CLOSE) && (Direction == 1)) //Center
                    {
                    TargetArray[TARGET_CENTER ] = true;
                    Serial.println("TargetCenter");
                    }

                    if ((cm_now < TARGET_TOO_CLOSE) && (Direction == 0)) //RIGHT
                    {
                    TargetArray[TARGET_RIGHT ] = true;
                    Serial.println("TargetRight");
                    }

                    }// END Directions

                    }// END LookAround

                    /**************************( STATE MACHINE FUNCTIONS )******************************/
                    State RoboStartState()
                    {
                    Serial.println("+++ RoboStartState");
                    digitalWrite(PIN13_LED,LOW);    // LED Means Target Too Close
                    ForwardFast();  // Start moving forward
                    delay(25);
                    ForwardSlow();  // Start moving forward
                    delay(600);
                    RoboGo.Set(RoboStopLookState);

                    }// END State RoboStartState


                    State RoboStopLookState()
                    {
                    Serial.println("+++ RoboStopLookState");

                    for (int i = 0; i < TARGET_ARRAY_SIZE; i++) TargetArray[i] = false;
                    Stop();  // Start moving forward
                    LookAround();     // Ping Ultrasonic in different directions, Set TargetArray

                    if      (TargetArray[TARGET_CENTER ] == true)  RoboGo.Set(RoboTargetCenter);
                    else if (TargetArray[TARGET_LEFT ]   == true)  RoboGo.Set(RoboTargetLeft);
                    else if (TargetArray[TARGET_RIGHT ]  == true)  RoboGo.Set(RoboTargetRight);
                    else     RoboGo.Set(RoboStartState);

                    }// END State RoboStartState


                    State RoboTargetLeft()
                    {
                    Serial.println("***** RoboTargetLeft");
                    Stop();
                    BackwardSlow(500);
                    SpinRight(500);
                    delay(500);
                    RoboGo.Set(RoboStartState);
                    }// END State RoboTargetLeft ----------------------

                    State RoboTargetCenter()
                    {
                    Serial.println("***** RoboTargetCenter");
                    Stop();
                    BackwardSlow(500);
                    SpinLeft(1100);
                    delay(500);
                    RoboGo.Set(RoboStartState);
                    } // END State RoboTargetCenter -----------------

                    State RoboTargetRight()
                    {
                    Serial.println("***** RoboTargetRight");
                    Stop();
                    delay(500);
                    BackwardSlow(500);
                    SpinLeft(500);
                    delay(500);
                    RoboGo.Set(RoboStartState);
                    }// END State RoboTargetRight -----------------

                    //*********( THE END )***********
        </code>

        </pre>
        
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h2>To get this code to work we need to install things called code "libraries".</h2>
        <p>Here is a detailed tutorial on how to install libraries. <a href="http://arduino-info.wikispaces.com/Arduino-Libraries">Here</a></p>
        <div class="col-md-6">
            <img src="img/Arduino-AddLibrary.jpg" alt=""/>
        </div>
        <ul class="col-md-6">
            <li>
                <a href="https://code.google.com/p/arduino-new-ping/downloads/detail?name=NewPing_v1.5.zip&can=2&q=">New Ping Library</a>
            </li>
            <li>
                <a href="http://playground.arduino.cc/Code/SMlib">SM Library</a>
            </li>
            <li>
                <a href="http://arduino-info.wikispaces.com/Arduino-Libraries#ydlibs">All major YourDuino Libraries</a>
            </li>
        </ul>
    </div>
</div>